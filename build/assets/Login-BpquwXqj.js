import{r as a,u as oe,a as se,b as ie,d as ne,j as e,m as b,S as J,e as le}from"./index-TXT2zbz-.js";import{C as M}from"./circle-alert-T-TtwyDS.js";import{U as ce}from"./user-JIrRSu65.js";import{A as _}from"./arrow-right-CImriW7s.js";import{C as de}from"./credit-card-BG1KDPaZ.js";import{L as R}from"./lock-CrZXY3Kw.js";import{I as ue}from"./info-DgQRGOc_.js";import{M as me}from"./mail-rY8HQB5i.js";import{E as K}from"./eye-off-C3P-sg4Y.js";import{E as Q}from"./eye-CTd2W4gV.js";function be(r){return r.replace(/<[^>]*>/g,"")}function he(r){return r.replace(/[^\d]/g,"").trim()}function ge(r){return be(r).replace(/\s+/g," ").trim()}function xe(r){const s={...r};for(const t in s)typeof s[t]=="string"&&(s[t]=ge(s[t]));return s}function Z({initialValues:r,validate:s,onSubmit:t,validateOnChange:N=!1}){const[u,C]=a.useState(r),[j,f]=a.useState({}),[$,E]=a.useState({}),[k,p]=a.useState(!1),[g,d]=a.useState(null),m=a.useCallback(c=>s(c),[s]),v=a.useCallback((c,x)=>{const h={...u,[c]:x};if(C(h),N){const n=m(h);f(n)}},[u,m,N]),A=a.useCallback(c=>{E(h=>({...h,[c]:!0}));const x=m(u);f(x)},[u,m]),I=a.useCallback((c,x)=>v(c,x),[v]),D=Object.keys(m(u)).length===0,B=a.useCallback(async c=>{c.preventDefault(),d(null);const x=Object.keys(u).reduce((n,y)=>({...n,[y]:!0}),{});E(x);const h=m(u);if(f(h),!(Object.keys(h).length>0)){p(!0);try{const n=xe(u);await t(n)}catch(n){const y=n instanceof Error?n.message:"Submission failed. Please try again.";d(y)}finally{p(!1)}}},[u,m,t]),L=a.useCallback(()=>{C(r),f({}),E({}),p(!1),d(null)},[r]);return{values:u,errors:j,touched:$,isSubmitting:k,isValid:D,submitError:g,handleChange:v,handleBlur:A,handleSubmit:B,setFieldValue:I,reset:L}}function fe(r){const s=r.replace(/[\s\-]/g,"");return s?/^\d+$/.test(s)?s.length!==10&&s.length!==17?{isValid:!1,error:"NID must be 10 or 17 digits"}:{isValid:!0}:{isValid:!1,error:"NID must contain digits only"}:{isValid:!1,error:"NID number is required"}}function pe(r){const s=r.replace(/[\s\-]/g,"");return s?/^\d{17}$/.test(s)?{isValid:!0}:{isValid:!1,error:"Birth registration number must be exactly 17 digits"}:{isValid:!1,error:"Birth registration number is required"}}function ve(r){return r?/^\d{6}$/.test(r)?{isValid:!0}:{isValid:!1,error:"OTP must be exactly 6 digits"}:{isValid:!1,error:"OTP is required"}}function Ne(r){if(!r)return{isValid:!1,error:"Date of birth is required"};const s=new Date(r);if(isNaN(s.getTime()))return{isValid:!1,error:"Invalid date format"};const t=new Date;return s>t?{isValid:!1,error:"Date of birth cannot be in the future"}:t.getFullYear()-s.getFullYear()>120?{isValid:!1,error:"Invalid date of birth"}:{isValid:!0}}const P=5,je=900*1e3;function Ve(){const{t:r,tRaw:s,language:t}=oe(),{login:N,logout:u,isAuthenticated:C,isLoading:j,error:f}=se(),$=ie(),k=ne().state?.from??"/dashboard";a.useEffect(()=>{C&&$(k,{replace:!0})},[C,$,k]);const[p,g]=a.useState("method"),[d,m]=a.useState(null),[v,A]=a.useState(!1),[I,D]=a.useState(!1),[B,L]=a.useState(""),[c,x]=a.useState(""),[h,n]=a.useState(""),[y,q]=a.useState(!1),[H,ee]=a.useState(!1),[z,re]=a.useState(P),O=a.useId(),w=a.useId(),V=a.useId(),U=a.useId(),W=a.useId(),te=a.useId(),Y=a.useRef(null),o=Z({initialValues:{idNumber:"",dateOfBirth:""},validate:({idNumber:i,dateOfBirth:T})=>{const S={};if(d){const X=d==="nid"?fe(i):pe(i);X.isValid||(S.idNumber=X.error??"")}const G=Ne(T);return G.isValid||(S.dateOfBirth=G.error??""),S},onSubmit:async()=>{const i=le("login:attempt",P,je);if(!i.allowed){ee(!0);return}re(i.remaining),g("otp"),setTimeout(()=>Y.current?.focus(),100)}}),l=Z({initialValues:{otpCode:""},validate:({otpCode:i})=>{const T={},S=ve(i);return S.isValid||(T.otpCode=S.error??""),T},onSubmit:async({otpCode:i})=>{d&&(await N({method:d,idNumber:he(o.values.idNumber),dateOfBirth:o.values.dateOfBirth,otpCode:i}),$(k,{replace:!0}))}}),F=f||o.submitError||l.submitError;async function ae(i){if(i.preventDefault(),n(""),!B.trim()){n("Email is required");return}if(!c){n("Password is required");return}q(!0),await N({method:"email",idNumber:"",dateOfBirth:"",email:B.trim().toLowerCase(),password:c}),q(!1)}return e.jsx("div",{className:"min-h-screen bg-linear-to-br from-[rgb(var(--color-bg))] via-white to-[rgb(var(--color-accent-light))] py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-linear-to-br from-[rgb(var(--color-primary))] to-[rgb(var(--color-accent))] flex items-center justify-center mx-auto mb-4","aria-hidden":"true",children:e.jsx(J,{className:"w-9 h-9 text-white"})}),e.jsx("h1",{className:`text-3xl mb-2 ${t==="bn"?"font-bangla":""}`,children:r("login.title")}),e.jsx("p",{className:`text-[rgb(var(--color-text-secondary))] ${t==="bn"?"font-bangla":""}`,children:r("login.subtitle")})]}),e.jsx("div",{id:te,role:"alert","aria-live":"assertive","aria-atomic":"true",className:"sr-only",children:F??""}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15,duration:.4},className:"bg-white rounded-2xl p-8 border border-[rgb(var(--color-border))]",style:{boxShadow:"var(--shadow-lg)"},children:[F&&e.jsxs("div",{className:"mb-6 flex gap-3 p-4 rounded-xl bg-red-50 border border-red-200 text-red-700",role:"status",children:[e.jsx(M,{className:"w-5 h-5 shrink-0 mt-0.5","aria-hidden":"true"}),e.jsx("p",{className:`text-sm ${t==="bn"?"font-bangla":""}`,children:F})]}),H&&e.jsxs("div",{className:"mb-6 flex gap-3 p-4 rounded-xl bg-amber-50 border border-amber-200 text-amber-700",children:[e.jsx(M,{className:"w-5 h-5 shrink-0 mt-0.5","aria-hidden":"true"}),e.jsx("p",{className:`text-sm ${t==="bn"?"font-bangla":""}`,children:r("login.locked")})]}),p==="method"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:`text-center mb-6 ${t==="bn"?"font-bangla":""}`,children:r("login.chooseMethod")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{m("birth_certificate"),g("credentials")},className:"w-full p-6 rounded-xl border-2 border-[rgb(var(--color-border))] hover:border-[rgb(var(--color-accent))] hover:bg-[rgb(var(--color-accent-light))] transition-colors text-left group focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-accent))]","aria-label":s("জন্ম নিবন্ধন নম্বর দিয়ে লগইন","Login with Birth Registration Number"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[rgb(var(--color-accent-light))] flex items-center justify-center group-hover:bg-[rgb(var(--color-accent))] transition-colors","aria-hidden":"true",children:e.jsx(ce,{className:"w-6 h-6 text-[rgb(var(--color-accent))] group-hover:text-white transition-colors"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`mb-1 ${t==="bn"?"font-bangla":""}`,children:r("login.birthMethod")}),e.jsx("p",{className:`text-sm text-[rgb(var(--color-text-secondary))] ${t==="bn"?"font-bangla":""}`,children:r("login.birthMethodDesc")})]}),e.jsx(_,{className:"w-5 h-5 text-[rgb(var(--color-text-light))] group-hover:text-[rgb(var(--color-accent))] transition-colors","aria-hidden":"true"})]})}),e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{m("nid"),g("credentials")},className:"w-full p-6 rounded-xl border-2 border-[rgb(var(--color-border))] hover:border-[rgb(var(--color-accent))] hover:bg-[rgb(var(--color-accent-light))] transition-colors text-left group focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-accent))]","aria-label":s("জাতীয় পরিচয়পত্র দিয়ে লগইন","Login with National ID Card"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[rgb(var(--color-accent-light))] flex items-center justify-center group-hover:bg-[rgb(var(--color-accent))] transition-colors","aria-hidden":"true",children:e.jsx(de,{className:"w-6 h-6 text-[rgb(var(--color-accent))] group-hover:text-white transition-colors"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`mb-1 ${t==="bn"?"font-bangla":""}`,children:r("login.nidMethod")}),e.jsx("p",{className:`text-sm text-[rgb(var(--color-text-secondary))] ${t==="bn"?"font-bangla":""}`,children:r("login.nidMethodDesc")})]}),e.jsx(_,{className:"w-5 h-5 text-[rgb(var(--color-text-light))] group-hover:text-[rgb(var(--color-accent))] transition-colors","aria-hidden":"true"})]})})]}),e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{m(null),g("admin-login")},className:"w-full p-6 rounded-xl border-2 border-dashed border-[rgb(var(--color-border))] hover:border-[rgb(var(--color-primary))] hover:bg-slate-50 transition-colors text-left group focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-primary))]","aria-label":"Admin or staff email login",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-slate-100 flex items-center justify-center group-hover:bg-slate-200 transition-colors","aria-hidden":"true",children:e.jsx(R,{className:"w-6 h-6 text-slate-500 group-hover:text-[rgb(var(--color-primary))] transition-colors"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`mb-1 text-slate-700 ${t==="bn"?"font-bangla":""}`,children:t==="bn"?"কর্মকর্তা / প্রশাসক প্রবেশ":"Admin / Staff Login"}),e.jsx("p",{className:`text-sm text-[rgb(var(--color-text-secondary))] ${t==="bn"?"font-bangla":""}`,children:t==="bn"?"ইমেইল ও পাসওয়ার্ড দিয়ে লগইন করুন":"Sign in with email and password"})]}),e.jsx(_,{className:"w-5 h-5 text-[rgb(var(--color-text-light))] group-hover:text-[rgb(var(--color-primary))] transition-colors","aria-hidden":"true"})]})}),e.jsx("div",{className:"mt-6 p-4 rounded-xl bg-[rgb(var(--color-accent-light))] border border-[rgb(var(--color-accent))]",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-[rgb(var(--color-accent))] shrink-0 mt-0.5","aria-hidden":"true"}),e.jsx("p",{className:`text-sm text-[rgb(var(--color-text-secondary))] ${t==="bn"?"font-bangla":""}`,children:r("login.firstTime")})]})})]}),p==="admin-login"&&e.jsxs(b.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onSubmit:ae,noValidate:!0,children:[e.jsxs("button",{type:"button",onClick:()=>{g("method"),n("")},className:`text-sm text-[rgb(var(--color-accent))] hover:text-[rgb(var(--color-primary))] mb-6 focus:outline-none focus:underline ${t==="bn"?"font-bangla":""}`,children:["← ",r("action.back")]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center","aria-hidden":"true",children:e.jsx(R,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t==="bn"?"প্রশাসক প্রবেশ":"Admin Login"}),e.jsx("p",{className:"text-xs text-[rgb(var(--color-text-secondary))]",children:"Restricted access — staff only"})]})]}),(h||f)&&e.jsxs("div",{className:"mb-4 flex gap-2 p-3 rounded-lg bg-red-50 border border-red-200 text-red-700",children:[e.jsx(M,{className:"w-4 h-4 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm",children:h||f})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:U,className:"block mb-2 text-sm font-medium",children:"Email address"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{id:U,type:"email",autoComplete:"username",value:B,onChange:i=>{L(i.target.value),n("")},placeholder:"admin@example.com","aria-required":"true",className:"w-full pl-10 pr-4 py-3 rounded-xl border border-[rgb(var(--color-border))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-primary))] focus:border-transparent transition-colors"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:W,className:"block mb-2 text-sm font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{id:W,type:I?"text":"password",autoComplete:"current-password",value:c,onChange:i=>{x(i.target.value),n("")},placeholder:"••••••••","aria-required":"true",className:"w-full pl-10 pr-12 py-3 rounded-xl border border-[rgb(var(--color-border))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-primary))] focus:border-transparent transition-colors"}),e.jsx("button",{type:"button",onClick:()=>D(i=>!i),"aria-label":I?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-700 focus:outline-none",children:I?e.jsx(K,{className:"w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5"})})]})]}),e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:y||j,className:"w-full py-3 px-4 rounded-xl bg-slate-800 hover:bg-slate-900 text-white font-semibold transition-colors disabled:opacity-60 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-700",children:y||j?"Signing in…":"Sign In"})]}),p==="credentials"&&d&&e.jsxs(b.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onSubmit:o.handleSubmit,noValidate:!0,children:[e.jsxs("button",{type:"button",onClick:()=>g("method"),className:`text-sm text-[rgb(var(--color-accent))] hover:text-[rgb(var(--color-primary))] mb-6 focus:outline-none focus:underline ${t==="bn"?"font-bangla":""}`,children:["← ",r("action.back")]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:O,className:`block mb-2 text-sm font-medium ${t==="bn"?"font-bangla":""}`,children:r(d==="birth_certificate"?"login.birthMethod":"login.nidMethod")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:O,type:v?"text":"password",inputMode:"numeric",autoComplete:"off",value:o.values.idNumber,onChange:i=>o.handleChange("idNumber",i.target.value),onBlur:()=>o.handleBlur("idNumber"),placeholder:d==="birth_certificate"?"12345678901234567":"1234567890",maxLength:17,"aria-required":"true","aria-invalid":o.touched.idNumber&&!!o.errors.idNumber,"aria-describedby":o.errors.idNumber?`${O}-error`:void 0,className:`w-full px-4 py-3 pr-12 rounded-xl border transition-colors focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-accent))] focus:border-transparent ${o.touched.idNumber&&o.errors.idNumber?"border-red-400 bg-red-50":"border-[rgb(var(--color-border))]"}`}),e.jsx("button",{type:"button",onClick:()=>A(i=>!i),"aria-label":v?s("নম্বর লুকান","Hide number"):s("নম্বর দেখুন","Show number"),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-700 focus:outline-none",children:v?e.jsx(K,{className:"w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5"})})]}),o.touched.idNumber&&o.errors.idNumber&&e.jsx("p",{id:`${O}-error`,role:"alert",className:`mt-1.5 text-sm text-red-600 ${t==="bn"?"font-bangla":""}`,children:o.errors.idNumber})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:w,className:`block mb-2 text-sm font-medium ${t==="bn"?"font-bangla":""}`,children:r("login.dob.label")}),e.jsx("input",{id:w,type:"date",value:o.values.dateOfBirth,onChange:i=>o.handleChange("dateOfBirth",i.target.value),onBlur:()=>o.handleBlur("dateOfBirth"),max:new Date().toISOString().split("T")[0],"aria-required":"true","aria-invalid":o.touched.dateOfBirth&&!!o.errors.dateOfBirth,"aria-describedby":`${w}-hint ${o.errors.dateOfBirth?`${w}-error`:""}`.trim(),className:`w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-accent))] focus:border-transparent ${o.touched.dateOfBirth&&o.errors.dateOfBirth?"border-red-400 bg-red-50":"border-[rgb(var(--color-border))]"}`}),e.jsx("p",{id:`${w}-hint`,className:`mt-1.5 text-xs text-[rgb(var(--color-text-light))] ${t==="bn"?"font-bangla":""}`,children:r("login.dob.hint")}),o.touched.dateOfBirth&&o.errors.dateOfBirth&&e.jsx("p",{id:`${w}-error`,role:"alert",className:`mt-1 text-sm text-red-600 ${t==="bn"?"font-bangla":""}`,children:o.errors.dateOfBirth})]}),z<P&&e.jsx("p",{className:`text-sm text-amber-600 mb-4 ${t==="bn"?"font-bangla":""}`,role:"status",children:r("login.attempts.warning",{remaining:z})}),e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:o.isSubmitting||H,className:`w-full py-3 px-4 rounded-xl bg-[rgb(var(--color-primary))] hover:bg-[rgb(var(--color-primary-hover))] text-white font-semibold transition-colors disabled:opacity-60 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[rgb(var(--color-primary))] ${t==="bn"?"font-bangla":""}`,children:o.isSubmitting?r("login.verifying"):r("action.next")})]}),p==="otp"&&e.jsxs(b.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onSubmit:l.handleSubmit,noValidate:!0,children:[e.jsxs("button",{type:"button",onClick:()=>g("credentials"),className:`text-sm text-[rgb(var(--color-accent))] hover:text-[rgb(var(--color-primary))] mb-6 focus:outline-none focus:underline ${t==="bn"?"font-bangla":""}`,children:["← ",r("action.back")]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-3","aria-hidden":"true",children:e.jsx(J,{className:"w-6 h-6 text-green-600"})}),e.jsx("h3",{className:`font-semibold mb-1 ${t==="bn"?"font-bangla":""}`,children:r("login.otp.sent")}),e.jsx("p",{className:`text-sm text-[rgb(var(--color-text-secondary))] ${t==="bn"?"font-bangla":""}`,children:r("login.otp.hint")})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:V,className:`block mb-2 text-sm font-medium ${t==="bn"?"font-bangla":""}`,children:r("field.otp")}),e.jsx("input",{id:V,ref:Y,type:"text",inputMode:"numeric",autoComplete:"one-time-code",maxLength:6,value:l.values.otpCode,onChange:i=>l.handleChange("otpCode",i.target.value.replace(/\D/g,"")),onBlur:()=>l.handleBlur("otpCode"),"aria-required":"true","aria-invalid":l.touched.otpCode&&!!l.errors.otpCode,"aria-describedby":l.errors.otpCode?`${V}-error`:void 0,className:`w-full px-4 py-3 rounded-xl border text-center text-2xl tracking-widest font-mono transition-colors focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-accent))] focus:border-transparent ${l.touched.otpCode&&l.errors.otpCode?"border-red-400 bg-red-50":"border-[rgb(var(--color-border))]"}`,placeholder:"_ _ _ _ _ _"}),l.touched.otpCode&&l.errors.otpCode&&e.jsx("p",{id:`${V}-error`,role:"alert",className:`mt-1.5 text-sm text-red-600 ${t==="bn"?"font-bangla":""}`,children:l.errors.otpCode})]}),e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:l.isSubmitting||j,className:`w-full py-3 px-4 rounded-xl bg-[rgb(var(--color-primary))] hover:bg-[rgb(var(--color-primary-hover))] text-white font-semibold transition-colors disabled:opacity-60 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[rgb(var(--color-primary))] ${t==="bn"?"font-bangla":""}`,children:l.isSubmitting||j?r("login.verifying"):r("login.submit")}),e.jsx("button",{type:"button",className:`w-full mt-3 text-sm text-[rgb(var(--color-accent))] hover:text-[rgb(var(--color-primary))] focus:outline-none focus:underline ${t==="bn"?"font-bangla":""}`,children:r("login.otp.resend")})]})]})]})})}export{Ve as Login};
